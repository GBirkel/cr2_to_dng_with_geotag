<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="stylesheet" href="https://mile42.net/wp-content/plugins/ptws/css/leaflet.css">
    <link rel="stylesheet" href="https://mile42.net/wp-content/plugins/ptws/css/ptws.css">
    <script src="https://mile42.net/wp-includes/js/jquery/jquery.js?ver=1.12.4" type="text/javascript"></script>
    <script src="https://mile42.net/wp-content/plugins/ptws/js/leaflet.js"></script>
    <script src="https://mile42.net/wp-content/plugins/ptws/js/Chart.bundle.min.js" type="text/javascript"></script>
    <script src="https://mile42.net/wp-content/plugins/ptws/js/ptws.js" type="text/javascript"></script>
  <title>PTWS Chart Template</title>
<style>

.ride_title {
    margin-left:2.5em;
}

div.ride_code {
    margin-left:2.5em;
}

div.ride_manage {
    margin-left:2.5em;
    display:flex;
    flex-direction:row;
}

div.ride_manage_feedback {
    flex-grow:1;
    margin-left:1.5em;
}

</style>
  <script type="text/javascript"> 

function doUpload(d, f) {
    var jqRideLogDiv = jQuery(d).first();
    var rideLogId = jqRideLogDiv.attr('rideid');
    var rawDataStr = jQuery(jqRideLogDiv).children().first().text()
    rawDataStr = rawDataStr.replace(/\r?\n|\r/g, " ");

    var data = {
        'route': rawDataStr,
        'id': rideLogId
    };
    // We can also pass the url value separately from ajaxurl for front end AJAX implementations
    jQuery.post('https://mile42.net/wp-json/ptws/v1/route', data, function (response) {
        jQuery(f).text(response);
    });
}


function initialize() {

    jQuery('div.ptws-ride-log').each(function (index, item) {
        var jqRideLogDiv = jQuery(item);
        var rideLogId = jqRideLogDiv.attr('rideid');

        var routeName = jQuery("<h1/>").attr("class", "ride_title").insertBefore(jqRideLogDiv);

        routeName.text(rideLogId);

        var codePanel = jQuery("<div/>").attr("class", "ride_code").insertAfter(routeName);

        codePanel.text('[ptwsroute routeid="' + rideLogId + '"]');

        var managePanel = jQuery("<div/>").attr("class", "ride_manage").insertAfter(codePanel);
        var firstPanel = jQuery("<div/>").appendTo(managePanel);
        var uploadButton = jQuery("<input/>").attr("type", "button").attr("name", "Upload").attr("value", "Upload").appendTo(firstPanel);
        var secondPanel = jQuery("<div/>").attr("class", "ride_manage_feedback").appendTo(managePanel);
        uploadButton.click(function () { doUpload(jqRideLogDiv.get(0), secondPanel.get(0)); });
    });

    // PTWS will call this for us.
    // ptws.findAndInitGPSLogDisplays();
}

  </script> 
</head>
<body onload="initialize();">

<!-- note: body and html tags are intentionally left off this template file -->
